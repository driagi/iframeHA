<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Temperatura Meteo Erzelli</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0b1020;
            color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            margin-bottom: 0.5rem;
        }
        #temp {
            font-size: 4rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        #status {
            font-size: 0.9rem;
            color: #aaa;
        }
        .error {
            color: #ff6666;
        }
    </style>
</head>
<body>

    <h1>Temperatura attuale</h1>
    <div id="temp">--.- °C</div>
    <div id="status">In attesa del primo aggiornamento…</div>

    <script>
        const URL = "https://meteoerzelli.altervista.org/cu/realtime_data.json?1758811359697";
        const tempEl = document.getElementById("temp");
        const statusEl = document.getElementById("status");

        async function aggiornaTemperatura() {
            const ora = new Date().toLocaleTimeString();

            try {
                statusEl.textContent = `Aggiorno dati… (${ora})`;
                const response = await fetch(URL, { cache: "no-store" });

                if (!response.ok) {
                    throw new Error("HTTP " + response.status);
                }

                const data = await response.json();

                // Simuliamo msg.payload.temp -> data.payload.temp
                const temp = data?.payload?.temp;

                if (temp === undefined || temp === null) {
                    tempEl.textContent = "N/D";
                    statusEl.textContent = `Campo payload.temp non trovato (${ora})`;
                    statusEl.classList.add("error");
                    return;
                }

                tempEl.textContent = `${temp} °C`;
                statusEl.textContent = `Ultimo aggiornamento: ${ora}`;
                statusEl.classList.remove("error");

            } catch (err) {
                tempEl.textContent = "Errore";
                statusEl.textContent = `Errore nel recupero dati: ${err.message} (${ora})`;
                statusEl.classList.add("error");
            }
        }

        // Primo aggiornamento subito
        aggiornaTemperatura();
        // Aggiornamento ogni 60 secondi
        setInterval(aggiornaTemperatura, 60 * 1000);
    </script>

</body>
</html>
</body>
</html>
