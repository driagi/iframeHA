<!DOCTYPE html>
<html>
    <head>
        <style>
            html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                background: #111111 !important;
                font-family: sans-serif;
                font-size: 24px;
                font-weight: bold;
            }

            #display {
                width: 100%;
                height: 100%;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #111111 !important;
            }

            #display div {
                width: fit-content;
                height: fit-content;
                text-align: center;
                color: #ffffff;
            }

            [data-state=undecided]{
                display: none;
            }
            [data-state=paused] div::after{
                content: "Click to keep page open";
            }
            [data-state=playing] div::after{
                content: "Page will stay open";
            }
        </style>
    </head>
    <body>
        <div id="display" data-state="undecided">
            <div></div>
        </div>

        <script>
            const nowMedia = () => `media.mp3?q=${Date.now()}`

            const audio = document.createElement("audio")
            audio.controls = false
            audio.src = nowMedia()
            audio.muted = true
            audio.autoplay = true
            document.body.appendChild(audio)

            const listenEvents = ["keydown", "pointerdown", "click"]

            const addAllListeners = (listener) => {
                listenEvents.forEach(ev => {
                    document.addEventListener(ev, listener)
                });
            }

            const removeAllListeners = (listener) => {
                listenEvents.forEach(ev => {
                    document.removeEventListener(ev, listener)
                });
            }

            const reload = () => {
                audio.src = nowMedia()
                audio.currentTime = 0
                audio.play()
            }

            audio.onended = reload

            const startMedia = () => {
                reload()
                audio.muted = false
            }

            audio.onplaying = () => removeAllListeners(startMedia)

            addAllListeners(startMedia)

            const display = document.getElementById("display")

            function checkAgain(){
                window.setTimeout(() => {
                    if (audio.paused){
                        display.dataset.state = "paused"
                        checkAgain()
                    } else {
                        display.dataset.state = "playing"
                    }
                }, 500);
            }

            checkAgain()

            // ✅ Click → sfondo e testo #111111
            document.addEventListener("click", () => {
                display.style.backgroundColor = "#111111";
                display.style.color = "#111111";
            });
        </script>
    </body>
</html>
